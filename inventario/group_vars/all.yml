# inventario/group_vars/all.yml
---
# Caminho absoluto para a pasta de artefatos
pasta_artefatos: "{{ playbook_dir }}/../artefatos"

# Pasta onde ficam os artefatos dos certificados
pasta_temporarios: "{{ pasta_artefatos }}/tmp"

# Versões dos componentes
versao_etcd: "3.6.4"         # https://endoflife.date/etcd
versao_kubernetes: "v1.34.1" # https://endoflife.date/kubernetes e https://dl.k8s.io/release/stable.txt

# Redes do projeto
rede_cidr_hosts: "172.24.0.0/24"
rede_cidr_pods: "172.24.4.0/22"
rede_cidr_services: "172.24.8.0/22"

# Primeiros IPs das redes
primeiro_ip_hosts: "{{ rede_cidr_hosts | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}"
primeiro_ip_pods: "{{ rede_cidr_pods | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}"
primeiro_ip_services: "{{ rede_cidr_services | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}"

# Portas usadas no projeto
porta_etcd_https: 2379
porta_etcd_peers: 2380
porta_etcd_metricas: 2381
porta_kubeapiserver: 6443

########################################
### Configurações para a role 02-pki ###
########################################

# Pasta onde ficam os artefatos dos certificados
pki_pasta_base: "{{ pasta_artefatos }}/pki"

# Pastas para os CAs e certificados:
pki_pastas:
  ca: "{{ pki_pasta_base }}/CAs"
  etcd: "{{ pki_pasta_base }}/etcd"
  k8s: "{{ pki_pasta_base }}/k8s"

# Configuração que decide se os certificados serão regerados
pki_regerar_certs: true

# Configurações para o Root CA
pki_root_ca:
  path_chave: "{{ pki_pastas.ca }}/root-ca-priv.pem"
  path_cert: "{{ pki_pastas.ca }}/root-ca-cert.pem"

# Configurações para os CAs intermediários
pki_cas:
  etcd:
    path_chave: "{{ pki_pastas.ca }}/ca-etcd-priv.pem"
    path_cert: "{{ pki_pastas.ca }}/ca-etcd-cert.pem"
    ca_pai: "{{ pki_root_ca }}"
  
  kubernetes:
    path_chave: "{{ pki_pastas.ca }}/ca-k8s-priv.pem"
    path_cert: "{{ pki_pastas.ca }}/ca-k8s-cert.pem"
    ca_pai: "{{ pki_root_ca }}"

# Configurações para os certificados
pki_certs:
  etcd_apiserver_cli:
    path_chave: "{{ pki_pastas.etcd }}/etcd-apiserver-cli-priv.pem"
    path_cert: "{{ pki_pastas.etcd }}/etcd-apiserver-cli-cert.pem"
    ca_pai: "{{ pki_cas['etcd'] }}"

  etcd_server:
    path_chave: "{{ pki_pastas.etcd }}/%s-etcd-node-server-priv.pem"
    path_cert: "{{ pki_pastas.etcd }}/%s-etcd-node-server-cert.pem"
    ca_pai: "{{ pki_cas['etcd'] }}"
  
  etcd_peer:
    path_chave: "{{ pki_pastas.etcd }}/%s-etcd-node-peer-priv.pem"
    path_cert: "{{ pki_pastas.etcd }}/%s-etcd-node-peer-cert.pem"
    ca_pai: "{{ pki_cas['etcd'] }}"

  kube_apiserver:
    path_chave: "{{ pki_pastas.k8s }}/%s-kube-apiserver-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/%s-kube-apiserver-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  kube_controller_manager:
    path_chave: "{{ pki_pastas.k8s }}/%s-kube-controller-manager-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/%s-kube-controller-manager-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  kube_scheduler:
    path_chave: "{{ pki_pastas.k8s }}/%s-kube-scheduler-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/%s-kube-scheduler-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  kubelet:
    path_chave: "{{ pki_pastas.k8s }}/%s-kubelet-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/%s-kubelet-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  kube_proxy:
    path_chave: "{{ pki_pastas.k8s }}/%s-kube-proxy-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/%s-kube-proxy-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  service_account:
    path_chave: "{{ pki_pastas.k8s }}/service-account-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/service-account-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"

  admin_account:
    path_chave: "{{ pki_pastas.k8s }}/admin-account-priv.pem"
    path_cert: "{{ pki_pastas.k8s }}/admin-account-cert.pem"
    ca_pai: "{{ pki_cas['kubernetes'] }}"